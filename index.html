<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professor Jeopardy! Manager</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Papa Parse (for CSV) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Load Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <!-- Load DOMPurify (for HTML sanitization) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Zilla+Slab:wght@700&display=swap" rel="stylesheet">
    </head>
<body class="min-h-screen p-4 sm:p-8">

    <div id="app" class="max-w-7xl mx-auto space-y-10">
        <!-- Hero / Scoreboard -->
        <section id="hero-panel" class="relative overflow-hidden rounded-3xl bg-slate-950 px-6 py-10 sm:px-10 sm:py-12 shadow-[0_25px_65px_rgba(2,6,23,0.65)]">
            <div class="hero-panel__glow" aria-hidden="true"></div>
            <div class="hero-panel__grid">
                <div class="hero-panel__intro space-y-6">
                    <div id="loadStatusIndicator" class="load-status load-status--idle" role="status" aria-live="polite">
                        <span id="loadStatusText" class="load-status__text">Ready to load a game</span>
                        <span class="load-status__dot" aria-hidden="true"></span>
                    </div>
                    <div class="space-y-4">
                        <h1 id="game-title" class="font-jeopardy text-4xl sm:text-5xl font-bold text-yellow-300 tracking-tight">
                            Dr. Baker's Marketing Jeopardy-O-Matic!
                        </h1>
                        <p class="text-lg text-slate-200 max-w-2xl">
                            Load your own deck or jump into a curated library game. Customize teams, themes, and timers — then smash that Start Game button when the hype feels right.
                        </p>
                    </div>
                    <div class="hero-panel__badges">
                        <div class="hero-panel__badge">
                            <span class="hero-panel__badge-label">New</span>
                            Lightning-fast CSV + Google Sheet importer
                        </div>
                        <div class="hero-panel__badge">
                            <span class="hero-panel__badge-label">Popular</span>
                            Pre-loaded games curated for marketing showdowns
                        </div>
                    </div>
                </div>
                <div class="hero-panel__scoreboard space-y-4">
                    <div class="hero-panel__scoreboard-card">
                        <div id="scoreboard" class="scoreboard-grid hidden"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Team Name Modal -->
        <div id="team-name-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-lg w-full mx-4 border-2 border-yellow-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">Set Team Names</h3>
                <p class="text-sm text-gray-300 mb-4">You can edit the team names below, generate random ones, or use the defaults.</p>
                <div id="team-name-list" class="space-y-3 max-h-72 overflow-auto mb-4">
                    <!-- Team name input rows will be injected here -->
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
                    <button id="normalNamesButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">Normal Team Name Generator</button>
                    <button id="dndNamesButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg">Cool and Good DnD Team Name Generator</button>
                    <button id="useDefaultNamesButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Use Defaults</button>
                </div>
                <div class="mt-4">
                    <button id="confirmNamesButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-lg">Confirm Names & Start Game</button>
                </div>
            </div>
        </div>

        <!-- Advanced Edit Modal -->
        <div id="advanced-edit-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-3xl w-full mx-4 border-2 border-yellow-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">Advanced Team Editor</h3>
                <p class="text-sm text-gray-300 mb-4">Edit team names (max 32 chars) and their scores. Click Save to apply.</p>
                <div id="advanced-edit-list" class="space-y-3 max-h-72 overflow-auto mb-4">
                    <!-- Team edit rows will be injected here -->
                </div>
                <div class="flex justify-end gap-3">
                    <button id="advancedCancelButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button id="advancedSaveButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Load Game Modal -->
        <div id="load-game-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-2xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Load Previous Game</h3>
                    <button id="closeLoadModalButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <p class="text-gray-300 text-sm mb-4">
                    To restore a game you previously saved, paste the long text string you copied into the field below and click "Load Game State". This will restore the questions, team scores, and which tiles have already been played.
                </p>
                <input type="text" id="loadCodeInput" placeholder="Paste save code here..." class="block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600 mb-2" />
                <button id="loadGameButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">Load Game State</button>
            </div>
        </div>

        <!-- Judge Mode Info Modal -->
        <div id="judge-mode-info-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-lg w-full mx-4 border-2 border-gray-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">About Judge Mode</h3>
                <p class="text-gray-300 text-sm mb-6">Judge Mode is an optional viewing mode for the game facilitator. It displays the game board and allows you to click any tile to instantly see both the clue and the correct response on a single screen. This mode has no teams, scoring, or timers, making it a perfect "answer key" to have on a separate device like a phone or tablet during the game.</p>
                <div class="flex justify-end gap-3">
                    <button id="cancelJudgeModeButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button id="proceedToJudgeModeButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Proceed to Code Entry</button>
                </div>
            </div>
        </div>

        <!-- Daily Double Modal -->
        <div id="daily-double-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-lg w-full mx-4 border-4 border-yellow-500">
                <h3 class="text-5xl font-extrabold text-yellow-400 mb-4 text-center animate-pulse">DAILY DOUBLE!</h3>
                <div class="space-y-4">
                    <label class="block">
                        <span class="text-gray-300 font-semibold">1. Select Bidding Team</span>
                        <select id="dailyDoubleTeamSelect" class="mt-1 block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600"></select>
                    </label>
                    <label class="block">
                        <span class="text-gray-300 font-semibold">2. Enter Wager</span>
                        <input type="number" id="dailyDoubleWager" placeholder="Enter wager amount..." min="0" class="mt-1 block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600" />
                    </label>
                    <button id="revealDailyDoubleClue" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg py-3 px-4 rounded-lg transition">Reveal Clue</button>
                </div>
            </div>
        </div>

        <!-- Custom Upload Tips Modal -->
        <div id="upload-tips-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-3xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Custom Upload Tips</h3>
                    <button id="closeUploadTipsButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <div class='text-gray-300 text-sm space-y-3 max-h-96 overflow-y-auto'>
                    <p>There are two easy ways to author a custom game:</p>
                    <ul class='list-disc list-inside space-y-2 pl-2'>
                        <li><strong>CSV template</strong> (best with Excel/Sheets) - export as CSV to keep quoting correct.</li>
                        <li><strong>TSV template</strong> (best for text editors) - tabs are friendlier when your text includes commas or quotes.</li>
                    </ul>
                    <p><strong>Auto-detect:</strong> The uploader detects CSV vs TSV and displays the detected delimiter after a successful load.</p>
                    <p class='mt-2'><strong>Authoring rules</strong> (applies to CSV and TSV):</p>
                    <ul class='list-disc list-inside space-y-2 pl-2'>
                        <li><strong>Rounds:</strong> Provide Round 1, Round 2, or both. Each round must have 5 categories x 5 clues.</li>
                        <li><strong>Values:</strong> Round 1 uses 100/200/300/400/500. Round 2 uses 200/400/600/800/1000.</li>
                        <li><strong>Daily Doubles:</strong> Put <code>Yes</code> in the <code>DailyDouble</code> column.</li>
                        <li><strong>Optional rows:</strong> Add <code>GameTitle</code> and <code>JudgeCode</code> before the header row.</li>
                        <li><strong>Explanation column:</strong> Use the <code>Explanation</code> column for optional teaching notes revealed after the correct response.</li>
                        <li><strong>Final Jeopardy:</strong> Add a row with <code>Category = FINAL JEOPARDY</code> and <code>Round = FJ</code>.</li>
                    </ul>
                    <p class='mt-2'><strong>Media</strong> (use <code>MediaType</code> + <code>MediaURL</code>):</p>
                    <ul class='list-disc list-inside space-y-2 pl-2'>
                        <li><strong>image</strong>: direct https image URL (avoid Drive/Dropbox share links).</li>
                        <li><strong>video</strong>: YouTube/Vimeo embed URLs only (e.g., <code>https://www.youtube.com/embed/VIDEO_ID</code>, <code>https://player.vimeo.com/video/ID</code>).</li>
                        <li><strong>html</strong>: Rich HTML is sanitized (p, strong, lists, tables, img[src|alt], a[href|target|rel], etc.). Scripts and javascript URLs are blocked.</li>
                    </ul>
                    <p class='mt-2'>Tip: If your text is heavy on punctuation, use the TSV template to avoid escaping headaches.</p>
                    <p class='mt-1'><strong>Google Sheets note:</strong> Loading from Sheets pulls a snapshot of the selected tab. It does <em>not</em> live-sync--update your sheet and click &quot;Load from Google Sheet&quot; again after edits.</p>
                </div>
                </div>
            </div>
        </div>

        <!-- Google Sheets Help Modal -->
        <div id="google-sheet-help-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-3xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Using Google Sheets</h3>
                    <button id="closeGoogleSheetHelpButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <div class="text-gray-300 text-sm space-y-3 max-h-96 overflow-y-auto">
                    <p>To load a game directly from Google Sheets, make the sheet (and the specific tab) public and paste its link:</p>
                    <div class="text-sm text-gray-300 bg-gray-800/70 p-3 rounded-lg space-y-2">
                        <p><strong>Checklist before loading:</strong></p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Use <strong>Share → Anyone with the link</strong> so the exporter can fetch the tab without signing in.</li>
                            <li>Open the desired tab (not just Sheet1) and copy the URL from your browser so it includes the correct <code>gid</code>.</li>
                            <li>For extra reliability, use <strong>File → Publish to the web</strong> and publish *just that tab* (choose TSV export if offered). Publishing the whole workbook may still serve the wrong page.</li>
                            <li>Once that specific tab is public, paste the URL above and click “Load from Google Sheet.”</li>
                        </ul>
                        <p class="text-xs text-gray-400">If the import still shows errors, open the normalized TSV export in a browser to inspect delimiter/row issues before retrying.</p>
                    </div>
                    <ol class="list-decimal list-inside space-y-2 pl-2">
                        <li>Open your sheet and select the tab you want (the URL will include <code>gid=...</code> for that tab).</li>
                        <li>Make it public:
                            <ul class="list-disc list-inside pl-4 space-y-1">
                                <li><strong>Option A:</strong> Share → General access → "Anyone with the link" (Viewer).</li>
                                <li><strong>Option B (recommended):</strong> File → Publish to the web → Entire document or specific sheet → Publish.</li>
                            </ul>
                        </li>
                        <li>Copy the sheet link and paste it into the input. The app converts it to a direct export (TSV) URL.</li>
                    </ol>
                    <p class="mt-2">Notes:</p>
                    <ul class="list-disc list-inside space-y-2 pl-2">
                        <li>We auto-detect CSV/TSV and validate the template headers/round structure.</li>
                        <li>Ensure the first rows follow the template (optional <code>GameTitle</code>, optional <code>JudgeCode</code>, then header row).</li>
                        <li>Only public sheets work. Private sheets will return an access error (401/403).</li>
                        <li>Pick the correct tab; the URL’s <code>gid</code> determines which tab is loaded.</li>
                        <li><strong>Snapshot only:</strong> Loading imports a snapshot of the sheet at that moment. It does not live sync. Re-load the link after you make changes.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Setup Screen -->
        <section id="setup-screen" class="rounded-3xl bg-slate-900/80 p-6 sm:p-10 shadow-2xl border border-white/5 backdrop-blur">
            <div class="text-center space-y-3">
                <p class="text-xs uppercase tracking-[0.4em] text-slate-300">Game Setup</p>
                <h2 class="text-3xl font-bold text-white">Choose your launch path</h2>
                <p class="text-base text-slate-300 max-w-2xl mx-auto">Bring your own custom deck or spin up a ready-made board. Everything below updates in real time.</p>
            </div>

            <div class="setup-card-grid">
                <!-- Left Column: Custom Game -->
                <article class="setup-card glass-card">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold text-yellow-300">Load Custom Game</h3>
                        <span class="setup-chip">CSV/TSV</span>
                    </div>
                    <p class="text-sm text-slate-300 mt-2 mb-4">Upload your worksheet or connect a published Google Sheet for collaborative editing.</p>
                    <label class="dropzone" for="csvFile">
                        <span class="dropzone__label">Drag &amp; drop or browse</span>
                        <span class="dropzone__hint">CSV / TSV supported</span>
                        <input type="file" id="csvFile" accept=".csv,.tsv,text/csv,text/tab-separated-values" class="sr-only">
                    </label>
                    <div class="text-xs text-slate-400 text-center mt-2">Need inspo? Expand the custom game tools below.</div>
                    <button id="customGameMenuButton" class="setup-secondary-btn mt-4">Make Your Own Custom Game</button>
                    <div id="customGameMenu" class="hidden space-y-2 border border-white/10 rounded-2xl p-4 mt-4 bg-slate-900/70">
                        <button id="downloadTemplate" class="setup-tertiary-btn">Download Template CSV</button>
                        <button id="downloadTemplateTSV" class="setup-tertiary-btn">Download Template TSV</button>
                        <button id="uploadTipsButton" class="setup-tertiary-btn">Custom Upload Tips</button>
                        <div class="pt-2 border-t border-white/10"></div>
                        <label class="block text-slate-200 text-sm font-semibold">Load from Google Sheet (public):</label>
                        <input id="googleSheetUrlInput" type="url" placeholder="Paste Google Sheet link (public)" class="setup-input">
                        <a href="https://docs.google.com/spreadsheets/d/1iCO1-LvMTzRg2O2AqUzJ6ALqWIkBi0Mtni9kDuCoVAk/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="text-xs text-blue-300 hover:text-blue-200 underline">See sample Google Sheet</a>
                        <button id="loadFromGoogleSheetButton" class="setup-primary-btn">Load from Google Sheet</button>
                        <button id="googleSheetHelpLink" class="text-xs text-blue-300 hover:text-blue-200 underline text-left">How to share/publish a Google Sheet</button>
                    </div>
                </article>

                <!-- Right Column: Pre-Loaded Game -->
                <article class="setup-card glass-card">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold text-yellow-300">Use Pre-Loaded Game</h3>
                        <span class="setup-chip setup-chip--teal">Library</span>
                    </div>
                    <p class="text-sm text-slate-300 mt-2 mb-4">Tap into curated game boards sorted by topic, difficulty, and vibe.</p>
                    <select id="defaultGameSelect" class="setup-select"></select>
                    <button id="loadDefaultGameButton" class="setup-primary-btn mt-4">Load from Library</button>
                </article>
            </div>

            <div class="setup-steps">
                <div class="setup-step">
                    <div class="setup-step__badge">1</div>
                    <div>
                        <p class="setup-step__title">Teams &amp; timers</p>
                        <p class="setup-step__desc">Decide how many groups play and if the auto timer is enabled.</p>
                    </div>
                </div>
                <div class="setup-step">
                    <div class="setup-step__badge">2</div>
                    <div>
                        <p class="setup-step__title">Visual theme</p>
                        <p class="setup-step__desc">Pick a palette so the board matches your session mood.</p>
                    </div>
                </div>
                <div class="setup-step">
                    <div class="setup-step__badge">3</div>
                    <div>
                        <p class="setup-step__title">Launch controls</p>
                        <p class="setup-step__desc">Start fresh, load a save, or jump into judge mode.</p>
                    </div>
                </div>
            </div>

            <!-- Game Settings -->
            <div class="setup-settings">
                <div class="setup-settings__header">
                    <h3 class="text-xl font-bold text-white">Game Settings</h3>
                    <p class="text-sm text-slate-400">Everything here can be updated mid-game</p>
                </div>
                <div class="setup-settings__grid">
                    <div>
                        <label class="setup-label" for="numTeams">Number of Teams</label>
                        <select id="numTeams" class="setup-select">
                            <option value="2">2 Teams</option>
                            <option value="3" selected>3 Teams</option>
                            <option value="4">4 Teams</option>
                            <option value="5">5 Teams</option>
                            <option value="6">6 Teams</option>
                            <option value="7">7 Teams</option>
                            <option value="8">8 Teams</option>
                            <option value="9">9 Teams</option>
                            <option value="10">10 Teams</option>
                        </select>
                    </div>
                    <div class="auto-timer-controls">
                        <label class="setup-toggle">
                            <input id="autoTimerEnabled" type="checkbox">
                            <span class="setup-toggle__appearance"></span>
                            <span class="setup-toggle__label">Auto Timer</span>
                        </label>
                        <label id="autoTimerSecondsWrapper" class="auto-timer-seconds hidden">
                            <span>Seconds</span>
                            <input id="autoTimerSeconds" type="number" min="5" max="120" value="20" class="setup-input w-24 text-center">
                        </label>
                    </div>
                    <div class="theme-picker">
                        <span class="setup-label">Color Theme</span>
                        <div id="themeSwatches" class="theme-pill-group" role="group" aria-label="Choose a color theme">
                            <button type="button" class="theme-pill" data-theme="classic">
                                <span class="theme-pill__dot theme-pill__dot--classic"></span>
                                <span>Classic</span>
                            </button>
                            <button type="button" class="theme-pill" data-theme="light">
                                <span class="theme-pill__dot theme-pill__dot--light"></span>
                                <span>Light</span>
                            </button>
                            <button type="button" class="theme-pill" data-theme="dark">
                                <span class="theme-pill__dot theme-pill__dot--dark"></span>
                                <span>Dark</span>
                            </button>
                            <button type="button" class="theme-pill" data-theme="christmas">
                                <span class="theme-pill__dot theme-pill__dot--holiday"></span>
                                <span>Holiday</span>
                            </button>
                            <button type="button" class="theme-pill" data-theme="highcontrast">
                                <span class="theme-pill__dot theme-pill__dot--contrast"></span>
                                <span>Contrast</span>
                            </button>
                        </div>
                        <select id="colorTheme" class="sr-only">
                            <option value="classic" selected>Jeopardy Classic</option>
                            <option value="light">Light Mode</option>
                            <option value="dark">Dark Mode</option>
                            <option value="christmas">Christmas Mode</option>
                            <option value="highcontrast">High Contrast</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Judge Mode -->
            <div id="judge-mode-container" class="hidden mt-6 text-center">
                <p class="text-sm text-slate-400 mb-3">or</p>
                <button id="judgeModeButton" class="setup-secondary-btn w-full">Enter Judge Mode</button>
            </div>

            <div class="setup-ctas">
                <button id="startGameButton" class="cta-primary" disabled>
                    <span>Start Game</span>
                    <span class="cta-primary__glow"></span>
                </button>
                <button id="loadPreviousGameButton" class="cta-ghost">Load Previous Game</button>
            </div>

            <p id="setup-message" class="setup-inline-alert setup-inline-alert--error hidden">Please upload a valid CSV file, or load a default/saved game.</p>
            <p id="final-jeopardy-status" class="text-sm text-slate-300 mt-2 hidden"></p>
            <div id="setup-error-details" class="text-xs text-slate-400 mt-2 hidden"></div>
        </section>

        <!-- Save Game Modal -->
        <div id="save-game-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-2xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Save Game State</h3>
                    <button id="closeSaveModalButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <p class="text-gray-300 text-sm mb-4">
                    This will generate a long text string that you can use to restore your game from its current position. It saves the questions, team names, scores, and all played tiles.
                </p>
                <input type="text" id="saveCodeDisplay" readonly class="w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600 text-xs sm:text-sm cursor-pointer" placeholder="Click 'Generate Save Code'"/>
                <button id="generateSaveCodeButton" class="w-full mt-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition">Generate Save Code</button>
            </div>
        </div>

        <!-- Judge Mode Controls (hidden until judge mode starts) -->
        <div id="judge-mode-controls" class="hidden my-4 flex justify-center gap-4">
            <!-- Round toggle buttons will be injected here -->
        </div>

        <!-- Game Board (Hidden until started) -->
        <div id="game-board" class="hidden grid gap-2" style="grid-template-columns: repeat(var(--num-categories), 1fr);">
            <!-- Categories and Clues will be injected here -->
        </div>

        <!-- Game Controls (hidden until game starts) -->
        <div id="game-controls-container" class="hidden mt-8 flex justify-center gap-4">
            <button id="newGameButton" class="bg-yellow-600 hover:bg-yellow-700 text-gray-900 font-bold py-2 px-4 rounded-lg transition">New Game</button>
            <button id="saveGameButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition">Save Game</button>
            <button id="finalJeopardyButton" class="hidden bg-purple-700 hover:bg-purple-800 text-white font-bold py-2 px-4 rounded-lg transition">Final Jeopardy</button>
            <button id="finishGameButton" class="bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-4 rounded-lg transition">Finish Game</button>
        </div>

        <!-- Clue Modal -->
        <div id="clue-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-4 border-yellow-500">
                <div id="clue-content" class="text-center mb-6">
                    <h3 id="clue-value-text" class="text-4xl font-extrabold text-yellow-400 mb-4"></h3>
                    <div id="clue-media" class="media-container my-4">
                        <!-- Media (Image/Video) will be injected here -->
                    </div>
                    <p id="clue-text" class="text-2xl text-white font-semibold"></p>
                    <p id="clue-answer" class="text-2xl text-green-400 mt-6 border-t border-gray-700 pt-4 hidden">
                        CORRECT RESPONSE: <span class="font-bold"></span>
                    </p>
                    <div id="clue-explanation" class="text-lg text-blue-200 mt-4 border-t border-gray-800 pt-4 hidden">
                        EXPLANATION: <span id="clue-explanation-text" class="font-semibold"></span>
                    </div>
                </div>
                
                <!-- Auto-timer display (bottom-right of clue modal) -->
                <div id="clue-timer" class="hidden absolute bottom-4 right-6 text-2xl font-extrabold px-4 py-2 rounded-lg bg-black bg-opacity-70 text-yellow-300 border-2 border-yellow-500">
                    00
                </div>

                <div id="clue-actions" class="mt-4">
                    <div class="flex justify-center mb-4 space-x-4">
                        <button id="revealAnswerButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl shadow-lg">
                            Reveal Answer
                        </button>
                        <button id="explainAnswerButton" class="hidden bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl shadow-lg">
                            Explain Answer
                        </button>
                        <button id="passClueButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl shadow-lg">
                            Pass / No Answer
                        </button>
                    </div>

                    <div id="scoring-section" class="pt-6 border-t border-gray-700">
                        <h4 class="text-xl text-yellow-400 font-bold mb-3 text-center">Assign Points (After Answer Revealed)</h4>
                        <div id="team-scoring-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            <!-- Team-specific scoring buttons injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Jeopardy Screen -->
        <div id="final-jeopardy-screen" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-4 border-purple-500 text-center">
                
                <!-- Step 1: Category Reveal -->
                <div id="fj-step-1-category">
                    <h2 class="text-3xl font-extrabold text-purple-400 mb-4">Final Jeopardy Category:</h2>
                    <p id="fj-category-text" class="text-5xl font-bold text-white mb-8"></p>
                    <button id="fj-proceed-to-wager" class="bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg py-3 px-6 rounded-lg">Proceed to Wager</button>
                </div>

                <!-- Step 2: Wager -->
                <div id="fj-step-2-wager" class="hidden">
                    <h2 class="text-3xl font-extrabold text-purple-400 mb-6">Place Your Wagers</h2>
                    <div id="fj-wager-list" class="space-y-3 mb-6 max-h-72 overflow-y-auto">
                        <!-- Wager inputs will be injected here -->
                    </div>
                    <button id="fj-lock-wagers" class="bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg py-3 px-6 rounded-lg">Lock Wagers & Reveal Clue</button>
                </div>

                <!-- Step 3: Clue & Scoring -->
                <div id="fj-step-3-clue" class="hidden">
                    <p id="fj-clue-text" class="text-4xl font-semibold text-white mb-6"></p>
                    <button id="fj-reveal-answer" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-4">Reveal Correct Response</button>
                    <div id="fj-answer-container" class="hidden">
                        <p class="text-xl text-gray-400">Correct Response:</p>
                        <p id="fj-answer-text" class="text-3xl font-bold text-green-400 mb-6"></p>
                        <h3 class="text-2xl text-purple-400 font-bold mb-3">Final Scoring</h3>
                        <div id="fj-scoring-list" class="space-y-3 mb-6"></div>
                        <button id="fj-finish-game" class="bg-green-600 hover:bg-green-700 text-white font-extrabold text-lg py-3 px-6 rounded-lg">Finish Game & See Standings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Standings Screen -->
        <div id="final-standings-screen" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-2xl w-full mx-4 border-4 border-yellow-500 text-center">
                <h2 class="text-5xl font-extrabold text-yellow-400 mb-6">Final Standings</h2>
                <div id="winner-container" class="mb-6">
                    <!-- The winner's card will be injected here -->
                </div>
                <div id="standings-list" class="space-y-4">
                    <!-- Ranked teams will be injected here -->
                </div>
                <div class="mt-8">
                    <button id="downloadReportButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">Download Performance Report</button>
                </div>
            </div>
        </div>

        <!-- Judge Mode Clue Modal -->
        <div id="judge-clue-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity" onclick="this.classList.add('hidden'); this.classList.remove('flex');">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-4 border-gray-500" onclick="event.stopPropagation();">
                <div id="judge-clue-content" class="text-center mb-6">
                    <h3 id="judge-clue-value-text" class="text-3xl font-extrabold text-gray-400 mb-4"></h3>
                    <div id="judge-clue-media" class="media-container my-4">
                        <!-- Media (Image/Video) will be injected here -->
                    </div>
                    <p id="judge-clue-text" class="text-2xl text-white font-semibold"></p>
                    <p id="judge-clue-answer" class="text-2xl text-green-400 mt-6 border-t border-gray-700 pt-4">
                        CORRECT RESPONSE: <span class="font-bold"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js" defer></script>
</body>
</html>
