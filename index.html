<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professor Jeopardy! Manager</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Papa Parse (for CSV) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Load Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <!-- Load DOMPurify (for HTML sanitization) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Zilla+Slab:wght@700&display=swap" rel="stylesheet">
    </head>
<body class="min-h-screen p-4 sm:p-8">

    <div id="app" class="max-w-7xl mx-auto">
        <h1 id="game-title" class="font-jeopardy text-5xl md:text-6xl font-bold text-yellow-400 mb-6 text-center tracking-tighter">Dr. Baker's Marketing Jeopardy-O-Matic!</h1>
        
        <!-- Scoreboard (Always Visible) -->
            <div id="scoreboard" class="flex flex-wrap justify-center gap-4 mb-2">
            <!-- Team Score Cards will be injected here -->
        </div>

        <!-- Advanced Edit Modal -->
        <div id="advanced-edit-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-3xl w-full mx-4 border-2 border-yellow-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">Advanced Team Editor</h3>
                <p class="text-sm text-gray-300 mb-4">Edit team names (max 32 chars) and their scores. Click Save to apply.</p>
                <div id="advanced-edit-list" class="space-y-3 max-h-72 overflow-auto mb-4">
                    <!-- Team edit rows will be injected here -->
                </div>
                <div class="flex justify-end gap-3">
                    <button id="advancedCancelButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button id="advancedSaveButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Load Game Modal -->
        <div id="load-game-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-2xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Load Previous Game</h3>
                    <button id="closeLoadModalButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <p class="text-gray-300 text-sm mb-4">
                    To restore a game you previously saved, paste the long text string you copied into the field below and click "Load Game State". This will restore the questions, team scores, and which tiles have already been played.
                </p>
                <input type="text" id="loadCodeInput" placeholder="Paste save code here..." class="block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600 mb-2" />
                <button id="loadGameButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">Load Game State</button>
            </div>
        </div>

        <!-- Judge Mode Info Modal -->
        <div id="judge-mode-info-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-lg w-full mx-4 border-2 border-gray-500">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">About Judge Mode</h3>
                <p class="text-gray-300 text-sm mb-6">Judge Mode is an optional viewing mode for the game facilitator. It displays the game board and allows you to click any tile to instantly see both the clue and the correct response on a single screen. This mode has no teams, scoring, or timers, making it a perfect "answer key" to have on a separate device like a phone or tablet during the game.</p>
                <div class="flex justify-end gap-3">
                    <button id="cancelJudgeModeButton" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button id="proceedToJudgeModeButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Proceed to Code Entry</button>
                </div>
            </div>
        </div>

        <!-- Daily Double Modal -->
        <div id="daily-double-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-lg w-full mx-4 border-4 border-yellow-500">
                <h3 class="text-5xl font-extrabold text-yellow-400 mb-4 text-center animate-pulse">DAILY DOUBLE!</h3>
                <div class="space-y-4">
                    <label class="block">
                        <span class="text-gray-300 font-semibold">1. Select Bidding Team</span>
                        <select id="dailyDoubleTeamSelect" class="mt-1 block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600"></select>
                    </label>
                    <label class="block">
                        <span class="text-gray-300 font-semibold">2. Enter Wager</span>
                        <input type="number" id="dailyDoubleWager" placeholder="Enter wager amount..." min="0" class="mt-1 block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600" />
                    </label>
                    <button id="revealDailyDoubleClue" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg py-3 px-4 rounded-lg transition">Reveal Clue</button>
                </div>
            </div>
        </div>

        <!-- Custom Upload Tips Modal -->
        <div id="upload-tips-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-3xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Custom Upload Tips</h3>
                    <button id="closeUploadTipsButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <div class="text-gray-300 text-sm space-y-3 max-h-96 overflow-y-auto">
                    <p>The easiest way to create a custom game is to <strong>download the template CSV and edit it</strong>. This ensures your file has the correct structure. If you create a file from scratch, follow these rules carefully:</p>
                    <ul class="list-disc list-inside space-y-2 pl-2">
                        <li><strong>Use the Template:</strong> Click the "Download Template CSV" button and use that file as your starting point.</li>
                        <li><strong>Strict Quoting:</strong> To avoid errors, enclose all text fields (`Category`, `Clue`, `Answer`) in double quotes. Example: `"SURVEY DESIGN"`, `"This is the clue."`, `"What is the answer?"`.</li>
                        <li><strong>Commas in Text:</strong> If your `Clue` or `Answer` contains a comma, you <strong>MUST</strong> enclose that entire cell's text in double quotes. Example: `"This clue which is tricky has a comma."`</li>
                        <li><strong>Round Structure:</strong> A valid game must have either a complete Round 1, a complete Round 2, or both.
                            <ul class="list-['-_'] list-inside pl-4">
                                <li>A complete round consists of exactly <strong>5 categories</strong>.</li>
                                <li>Each of the 5 categories must have exactly <strong>5 clues</strong>.</li>
                            </ul>
                        </li>
                        <li><strong>Point Values:</strong> Round 1 values must be 100-500. Round 2 values must be 200-1000. The template has the correct values already set up.</li>
                        <li><strong>Daily Doubles:</strong> To make a clue a Daily Double, type `Yes` in its `DailyDouble` column. Otherwise, type `No` or leave it blank.</li>
                        <li><strong>Media Clues:</strong> `MediaType` can be `image`, `video`, or `html`. For `html`, the `MediaURL` column should contain the raw HTML code you want to display (e.g., `"<p>This is <b>bold</b>.</p>"`).</li>
                        <li><strong>Optional Rows:</strong> You can add `GameTitle` and `JudgeCode` rows at the very top of your file for customization. See the template for an example.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Setup Screen -->
        <div id="setup-screen" class="bg-gray-800 p-6 rounded-xl shadow-2xl space-y-6">
            <h2 class="text-2xl font-bold text-white mb-2 text-center">Game Setup</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Left Column: Custom Game -->
                <div class="bg-gray-700 p-4 rounded-lg space-y-4 flex flex-col">
                    <h3 class="text-xl font-bold text-yellow-400 text-center">Load Custom Game</h3>
                    <input type="file" id="csvFile" accept=".csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100" />
                    <div class="flex-grow"></div> <!-- Pushes buttons to the bottom -->
                    <div class="space-y-2">
                        <button id="downloadTemplate" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition">Download Template CSV</button>
                        <button id="uploadTipsButton" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">Custom Upload Tips</button>
                    </div>
                </div>

                <!-- Right Column: Pre-Loaded Game -->
                <div class="bg-gray-700 p-4 rounded-lg space-y-4 flex flex-col">
                    <h3 class="text-xl font-bold text-yellow-400 text-center">Use Pre-Loaded Game</h3>
                    <select id="defaultGameSelect" class="w-full bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition"></select>
                    <button id="loadDefaultGameButton" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition">Load from Library</button>
                </div>
            </div>

            <!-- Number of Teams -->
            <div class="pt-4 border-t border-gray-600">
                <label class="block">
                    <span class="text-gray-300 font-semibold">Number of Teams</span>
                    <select id="numTeams" class="mt-1 block w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600 focus:ring-yellow-500 focus:border-yellow-500">
                        <option value="2">2 Teams</option>
                        <option value="3" selected>3 Teams</option>
                        <option value="4">4 Teams</option>
                        <option value="5">5 Teams</option>
                        <option value="6">6 Teams</option>
                        <option value="7">7 Teams</option>
                        <option value="8">8 Teams</option>
                        <option value="9">9 Teams</option>
                        <option value="10">10 Teams</option>
                    </select>
                </label>
            </div>

            <!-- Judge Mode -->
            <div id="judge-mode-container" class="hidden">
                <p class="text-center text-gray-500 my-2">or</p>
                <button id="judgeModeButton" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition">Enter Judge Mode</button>
            </div>

            <button id="startGameButton" class="w-full bg-gray-600 text-gray-400 font-extrabold text-lg py-3 px-4 rounded-lg transition cursor-not-allowed" disabled>
                Start Game
            </button>
            <button id="loadPreviousGameButton" class="w-full bg-yellow-600 hover:bg-yellow-700 text-gray-900 font-bold py-2 px-3 rounded-lg transition text-sm">Load Previous Game</button>

            <p id="setup-message" class="text-sm text-red-400 mt-2 hidden">Please upload a valid CSV file, or load a default/saved game.</p>
        </div>

        <!-- Save Game Modal -->
        <div id="save-game-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-2xl w-full mx-4 border-2 border-yellow-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-yellow-400">Save Game State</h3>
                    <button id="closeSaveModalButton" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
                </div>
                <p class="text-gray-300 text-sm mb-4">
                    This will generate a long text string that you can use to restore your game from its current position. It saves the questions, scores, and all played tiles.
                </p>
                <input type="text" id="saveCodeDisplay" readonly class="w-full rounded-lg bg-gray-700 text-white p-2 border border-gray-600 text-xs sm:text-sm cursor-pointer" placeholder="Click 'Generate Save Code'"/>
                <button id="generateSaveCodeButton" class="w-full mt-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition">Generate Save Code</button>
            </div>
        </div>

        <!-- Game Board (Hidden until started) -->
        <div id="game-board" class="hidden grid gap-2" style="grid-template-columns: repeat(var(--num-categories), 1fr);">
            <!-- Categories and Clues will be injected here -->
        </div>

        <!-- Game Controls (hidden until game starts) -->
        <div id="game-controls-container" class="hidden mt-8 flex justify-center gap-4">
            <button id="newGameButton" class="bg-yellow-600 hover:bg-yellow-700 text-gray-900 font-bold py-2 px-4 rounded-lg transition">New Game</button>
            <button id="saveGameButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition">Save Game</button>
            <button id="finalJeopardyButton" class="hidden bg-purple-700 hover:bg-purple-800 text-white font-bold py-2 px-4 rounded-lg transition">Final Jeopardy</button>
            <button id="finishGameButton" class="bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-4 rounded-lg transition">Finish Game</button>
        </div>

        <!-- Clue Modal -->
        <div id="clue-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-4 border-yellow-500">
                <div id="clue-content" class="text-center mb-6">
                    <h3 id="clue-value-text" class="text-4xl font-extrabold text-yellow-400 mb-4"></h3>
                    <div id="clue-media" class="media-container my-4">
                        <!-- Media (Image/Video) will be injected here -->
                    </div>
                    <p id="clue-text" class="text-2xl text-white font-semibold"></p>
                    <p id="clue-answer" class="text-2xl text-green-400 mt-6 border-t border-gray-700 pt-4 hidden">
                        CORRECT RESPONSE: <span class="font-bold"></span>
                    </p>
                </div>
                
                <div id="clue-actions" class="mt-4">
                    <div class="flex justify-center mb-4 space-x-4">
                        <button id="revealAnswerButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl shadow-lg">
                            Reveal Answer
                        </button>
                        <button id="passClueButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl shadow-lg">
                            Pass / No Answer
                        </button>
                    </div>

                    <div id="scoring-section" class="pt-6 border-t border-gray-700">
                        <h4 class="text-xl text-yellow-400 font-bold mb-3 text-center">Assign Points (After Answer Revealed)</h4>
                        <div id="team-scoring-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            <!-- Team-specific scoring buttons injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Jeopardy Screen -->
        <div id="final-jeopardy-screen" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-4 border-purple-500 text-center">
                
                <!-- Step 1: Category Reveal -->
                <div id="fj-step-1-category">
                    <h2 class="text-3xl font-extrabold text-purple-400 mb-4">Final Jeopardy Category:</h2>
                    <p id="fj-category-text" class="text-5xl font-bold text-white mb-8"></p>
                    <button id="fj-proceed-to-wager" class="bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg py-3 px-6 rounded-lg">Proceed to Wager</button>
                </div>

                <!-- Step 2: Wager -->
                <div id="fj-step-2-wager" class="hidden">
                    <h2 class="text-3xl font-extrabold text-purple-400 mb-6">Place Your Wagers</h2>
                    <div id="fj-wager-list" class="space-y-3 mb-6 max-h-72 overflow-y-auto">
                        <!-- Wager inputs will be injected here -->
                    </div>
                    <button id="fj-lock-wagers" class="bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-lg py-3 px-6 rounded-lg">Lock Wagers & Reveal Clue</button>
                </div>

                <!-- Step 3: Clue & Scoring -->
                <div id="fj-step-3-clue" class="hidden">
                    <p id="fj-clue-text" class="text-4xl font-semibold text-white mb-6"></p>
                    <button id="fj-reveal-answer" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-4">Reveal Correct Response</button>
                    <div id="fj-answer-container" class="hidden">
                        <p class="text-xl text-gray-400">Correct Response:</p>
                        <p id="fj-answer-text" class="text-3xl font-bold text-green-400 mb-6"></p>
                        <h3 class="text-2xl text-purple-400 font-bold mb-3">Final Scoring</h3>
                        <div id="fj-scoring-list" class="space-y-3 mb-6"></div>
                        <button id="fj-finish-game" class="bg-green-600 hover:bg-green-700 text-white font-extrabold text-lg py-3 px-6 rounded-lg">Finish Game & See Standings</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Standings Screen -->
        <div id="final-standings-screen" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-2xl w-full mx-4 border-4 border-yellow-500 text-center">
                <h2 class="text-5xl font-extrabold text-yellow-400 mb-6">Final Standings</h2>
                <div id="winner-container" class="mb-6">
                    <!-- The winner's card will be injected here -->
                </div>
                <div id="standings-list" class="space-y-4">
                    <!-- Ranked teams will be injected here -->
                </div>
                <div class="mt-8">
                    <button id="downloadReportButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">Download Performance Report</button>
                </div>
            </div>
        </div>

        <!-- Judge Mode Clue Modal -->
        <div id="judge-clue-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay transition-opacity" onclick="this.classList.add('hidden'); this.classList.remove('flex');">
            <div class="bg-gray-900 p-8 rounded-xl shadow-2xl max-w-4xl w-full mx-4 border-4 border-gray-500" onclick="event.stopPropagation();">
                <div id="judge-clue-content" class="text-center mb-6">
                    <h3 id="judge-clue-value-text" class="text-3xl font-extrabold text-gray-400 mb-4"></h3>
                    <div id="judge-clue-media" class="media-container my-4">
                        <!-- Media (Image/Video) will be injected here -->
                    </div>
                    <p id="judge-clue-text" class="text-2xl text-white font-semibold"></p>
                    <p id="judge-clue-answer" class="text-2xl text-green-400 mt-6 border-t border-gray-700 pt-4">
                        CORRECT RESPONSE: <span class="font-bold"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js" defer></script>
</body>
</html>
